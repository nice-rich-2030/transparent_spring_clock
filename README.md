# Transparent Spring Clock

透明なスプリングドライブ式時計の3Dビューアです。three.jsを使用してリアルタイムに描画される時計のムーブメントを、あらゆる角度から観察できます。

[Demo](https://nice-rich-2030.github.io/transparent_spring_clock/)

## 背景・課題

機械式時計（スプリングドライブ）の精巧な内部機構は、実物では外装に覆われて見えづらく、時計愛好家や学習者が、ゼンマイ・歯車・脱進機などの動作原理を直感的に理解・観賞できる手段が限られています。

本プロジェクトでは、three.jsを用いた3Dインタラクティブビューアを開発し、すべての部品を半透明でレンダリングすることで、内部機構が透けて見える「スケルトン時計」を実現しました。ユーザーは自由にカメラを操作し、あらゆる角度から時計の動きを観賞できます。

## 特徴

- **リアルタイムJST表示** — 日本標準時をスイープ運針で滑らかに表示
- **透明ムーブメント** — 全パーツが半透明で内部構造が見える
- **インタラクティブ操作** — マウスドラッグで自由に回転・ズーム
- **パーツ情報表示** — ホバーで各部品の名称と説明をツールチップ表示
- **オフライン動作** — 外部API不要、ブラウザだけで完結

## 時計の構造

### 輪列（ギアトレイン）

香箱車 → 2番車 → 3番車 → 4番車 → ガンギ車 → アンクル → テンプの輪列で動力を伝達します。各車には外側の歯車とカナ（ピニオン）があり、前段の外歯が次段のカナと噛み合って回転を伝えます。

### 主要部品

| 部品 | 説明 |
|------|------|
| 香箱（バレル） | 主ゼンマイを収納する円柱形ケース。ゼンマイがほどける力で歯車を回転 |
| 輪列（5枚歯車） | 香箱車から脱進機へ、ギア比に基づき回転を伝達 |
| 脱進機 | ガンギ車とアンクルによる間欠運動で回転を制御 |
| 調速機（てんぷ） | ひげゼンマイと共に振動し、時計の精度を決定 |
| 発電機構 | ローター・コイル・磁石による電磁ブレーキ表現 |
| 水晶振動子・IC | 32,768Hz基準信号を発光で象徴的に表現 |
| 針（時・分・秒） | 秒針はスイープ運針で滑らかに連続回転 |

### スイープ運針

一般的なクオーツ時計の1秒ごとのステップ運針と異なり、スプリングドライブはミリ秒精度で秒針が滑らかに連続回転します。本ビューアではこの特徴を忠実に再現しています。

## 技術スタック

| カテゴリ | 技術 | 選定理由 |
|----------|------|----------|
| 言語 | [TypeScript](https://www.typescriptlang.org/) | 型安全性により複雑な3D座標計算のバグを防止 |
| 3Dライブラリ | [three.js](https://threejs.org/) (r160) | Webブラウザ3Dのデファクトスタンダード |
| ビルドツール | [Vite](https://vitejs.dev/) | 高速HMR、TypeScript対応 |
| カメラ制御 | OrbitControls | three.js標準の回転・ズーム・パン操作 |
| マテリアル | MeshPhysicalMaterial | 半透明ガラス表現、屈折・反射のリアルな質感 |

### 技術的なポイント

- **半透明レンダリング**: `MeshPhysicalMaterial`の`transmission`/`opacity`を活用し、ガラス・金属・ゼンマイそれぞれに適した透明度を設定
- **歯車形状**: `Shape` + `ExtrudeGeometry`で歯のプロファイルを生成し、カナ（ピニオン）との噛み合いを再現
- **渦巻きバネ**: `CatmullRomCurve3` + `TubeGeometry`で主ゼンマイ・ひげゼンマイの螺旋形状を生成
- **ライティング**: `HemisphereLight` + 複数の`PointLight`で広範囲を照らし、半透明部品の美しい質感を表現
- **Raycasting**: マウスホバーで部品を検出し、ツールチップを動的に表示

## 開発

### 動作要件

- Node.js 18+
- WebGL 2.0 対応ブラウザ（Chrome 90+, Firefox 90+, Safari 15+, Edge 90+）

### コマンド

```bash
# 依存パッケージのインストール
npm install

# 開発サーバーの起動
npm run dev

# プロダクションビルド
npm run build

# ビルド結果のプレビュー
npm run preview
```

### プロジェクト構成

```
src/
├── main.ts                  # アプリ初期化・アニメーションループ
├── scene/
│   ├── SceneManager.ts      # シーン・カメラ・ライト管理
│   └── Renderer.ts          # WebGLRenderer設定
├── watch/
│   ├── WatchAssembly.ts     # 時計全体の組み立て
│   ├── parts/
│   │   ├── Barrel.ts        # 香箱＋主ゼンマイ
│   │   ├── GearTrain.ts     # 輪列（歯車＋カナ）
│   │   ├── Escapement.ts    # 脱進機（ガンギ車・アンクル）
│   │   ├── Balance.ts       # 調速機（てんぷ・ひげゼンマイ）
│   │   ├── Generator.ts     # 発電機構（ローター・コイル）
│   │   ├── Quartz.ts        # 水晶振動子・IC
│   │   ├── Hands.ts         # 時針・分針・秒針
│   │   └── Case.ts          # 文字盤・ケース・風防
│   └── materials/
│       └── TransparentMaterial.ts  # 半透明マテリアル
├── time/
│   └── TimeController.ts    # JST取得・針角度計算
├── controls/
│   └── CameraController.ts  # カメラ操作・プリセット視点
├── ui/
│   ├── UIManager.ts         # UI管理・ツールチップ
│   ├── InfoPanel.ts         # 部品情報パネル
│   └── DebugPanel.ts        # FPS・ワイヤーフレーム
└── types/
    └── index.ts             # 型定義
```

## 操作方法

| 操作 | 説明 |
|------|------|
| マウスドラッグ | 視点の回転 |
| スクロール | ズームイン/アウト |
| 右ドラッグ | パン移動 |
| ヘッダーメニュー | カメラプリセット切替（正面・裏面・側面・ムーブメント） |
| フッターメニュー | 自動回転・ヘルプ・設定 |
| 部品ホバー | 部品名と説明のツールチップ表示 |

## ライセンス

MIT
